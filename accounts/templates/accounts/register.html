{% extends "main.html" %}
{% load form_tags %}

{% block content %}
<div class="min-h-screen flex flex-col justify-center py-12 px-2 sm:px-6 lg:px-8 bg-gray-50">
    <div class="sm:mx-auto sm:w-full sm:max-w-md">
        <h2 class="mt-6 text-center text-3xl font-extrabold text-gray-900">Register your account</h2>
    </div>

    <div class="mt-8 sm:mx-auto sm:w-full sm:max-w-md">
        <div class="bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10">
            <form method="POST" action="{% url 'accounts:register' %}" class="space-y-6" id="registerForm" novalidate>
                {% csrf_token %}
                
                {% if form.non_field_errors %}
                    <div class="mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded">
                        {% for error in form.non_field_errors %}
                            <p>{{ error }}</p>
                        {% endfor %}
                    </div>
                {% endif %}

                {% for field in form %}
                    <div>
                        <label for="{{ field.id_for_label }}" class="block text-sm font-medium text-gray-700">{{ field.label }}</label>
                        <div class="mt-1">
                            {{ field|add_class:"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-amber-500 focus:border-amber-500 sm:text-sm" }}
                            {% if field.errors %}
                                <span class="text-red-500 text-sm">{{ field.errors }}</span>
                            {% endif %}
                            {% if field.name == "phone" %}
                                <span id="phone-error" class="text-red-500 text-sm hidden"></span>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}

                <div>
                    <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-amber-500 hover:bg-amber-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 transition-colors duration-200">
                       Register
                    </button>
                </div>
                <div class="mt-2 flex justify-between items-center gap-5 text-center text-sm text-gray-600">
                    <p>
                        Already have an account?
                        <a href="{% url 'accounts:login' %}" class="font-medium text-amber-600 hover:text-amber-500">Sign in</a>
                    </p>
                </div>
            </form>
        </div>
    </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('registerForm');
    const phoneInput = form.querySelector('input[name="phone"]');
    const phoneError = document.getElementById('phone-error');

    if (phoneInput) {
        form.addEventListener('submit', function(e) {
            // Pakistani phone number regex: starts with 03, then 9 digits (total 11 digits)
            const pkPhoneRegex = /^03[0-9]{9}$/;
            if (!pkPhoneRegex.test(phoneInput.value)) {
                e.preventDefault();
                phoneError.textContent = "Enter a valid Pakistani phone number (e.g. 03XXXXXXXXX)";
                phoneError.classList.remove('hidden');
                phoneInput.classList.add('border-red-500');
            } else {
                phoneError.textContent = "";
                phoneError.classList.add('hidden');
                phoneInput.classList.remove('border-red-500');
            }
        });
    }
});
</script>
{% endblock %}