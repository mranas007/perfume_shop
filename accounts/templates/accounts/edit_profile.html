{% extends 'main.html' %}
{% load form_tags %}

{% block content %}
<div class="max-w-2xl mx-auto min-h-screen py-8 px-2">
  <div class="mt-[100px] mb-[20px] bg-white rounded-2xl shadow-2xl overflow-hidden transition-all duration-300">
    <div class="bg-gradient-to-br from-amber-500 to-amber-600 px-8 py-8 text-center">
      <h1 class="text-3xl font-bold text-white">Edit Profile</h1>
      <p class="text-white text-opacity-90">Update your personal information</p>
    </div>
    <div class="p-6 sm:p-8">
      <form id="registerForm" method="POST" class="space-y-6">
        {% csrf_token %}
        {% if messages %}
          <div class="space-y-2">
            {% for message in messages %}
              <div class="p-3 rounded-lg {% if message.tags == 'success' %}bg-green-50 text-green-700 border border-green-200{% else %}bg-red-50 text-red-700 border border-red-200{% endif %}">
                {{ message }}
              </div>
            {% endfor %}
          </div>
        {% endif %}

        <!-- Name -->
        <div class="group bg-gray-50 rounded-xl p-5 transition border border-gray-200 focus-within:ring-2 focus-within:ring-amber-500">
          <label class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2 block">Name</label>
          {{ form.name|add_class:'w-full bg-transparent outline-none ring-0 p-2 rounded-md' }}
          {% if form.name.errors %}
            <p class="text-sm text-red-600 mt-2">{{ form.name.errors.0 }}</p>
          {% endif %}
        </div>

        <!-- Phone Number -->
        <div class="group bg-gray-50 rounded-xl p-5 transition border border-gray-200 focus-within:ring-2 focus-within:ring-amber-500">
          <label class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2 block">Phone Number</label>
          {{ form.phone|add_class:'w-full bg-transparent outline-none ring-0 p-2 rounded-md' }}
          
          <!-- Server-side error -->
          {% if form.phone.errors %}
            <p class="text-sm text-red-600 mt-2">{{ form.phone.errors.0 }}</p>
          {% endif %}
          <!-- Client-side error -->
          <p id="phone-error" class="hidden text-sm text-red-600 mt-2"></p>
        </div>

        <div class="flex flex-col sm:flex-row gap-4 mt-4">
          <a href="{% url 'accounts:profile' %}" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-3 px-6 rounded-xl text-center">
            Cancel
          </a>
          <button type="submit" class="flex-1 bg-gradient-to-r from-amber-500 to-amber-600 hover:from-amber-600 hover:to-amber-700 text-white font-semibold py-3 px-6 rounded-xl shadow-lg">
            Save Changes
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('registerForm');
    const phoneInput = form.querySelector('input[name="phone"]');
    const phoneError = document.getElementById('phone-error');

    if (phoneInput) {
        form.addEventListener('submit', function(e) {
            // Pakistani phone number regex: starts with 03, then 9 digits (total 11 digits)
            const pkPhoneRegex = /^03[0-9]{9}$/;

            if (!pkPhoneRegex.test(phoneInput.value.trim())) {
                e.preventDefault();
                phoneError.textContent = "Enter a valid phone number (e.g. 03XXXXXXXXX)";
                phoneError.classList.remove('hidden');
                phoneInput.classList.add('border-red-500');
            } else {
                phoneError.textContent = "";
                phoneError.classList.add('hidden');
                phoneInput.classList.remove('border-red-500');
            }
        });
    }
});
</script>
{% endblock %}
